<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memorandumMapper">
	<resultMap type="Memorandum" id="MemorandumMap">
		<result property="seq" column="seq"/>
		<result property="type" column="type"/>
		<result property="subject" column="subject"/>
		<result property="comment" column="comment"/>
		<result property="area" column="area"/>
		<result property="articles" column="articles" />
		<result property="articleComment" column="article_comment"/>
		<result property="chiefOfOffice" column="chief_of_office"/>
		<result property="officeInfo" column="office_info"/>
		<result property="areaDirector" column="area_director"/>
		<result property="gblSeq" column="gbl_seq" />
		<result property="writeDate" column="write_date" />
		<result property="extraPickUpCharge" column="extra_pick_up_charge" />
		<result property="termination" column="termination" />
		<result property="sitStartDate" column="sit_start_date" />
		<result property="sitEndDate" column="sit_end_date" />
		<result property="longCarry" column="long_carry" />
	</resultMap>
	
	<select id="getMemorandum" parameterType="Memorandum" resultMap="MemorandumMap">
		SELECT
			seq, type, subject, comment, area, articles, article_comment, chief_of_office, office_info, area_director, gbl_seq, write_date
		FROM
			memorandum
		WHERE
			gbl_seq = #{gblSeq}
		AND
			type = #{type}
		AND
			memorandum_list_seq = #{memorandumSeq}
	</select>
	
	<select id="getMemorandumList" parameterType="Map" resultMap="MemorandumMap">
		SELECT
			seq, type, subject, comment, area, articles, article_comment, chief_of_office, office_info, area_director, gbl_seq, extra_pick_up_charge, termination, sit_start_date, sit_end_date, long_carry
		FROM
			memorandum
		WHERE
			gbl_seq = #{seq}
		<if test="memorandumSeq != null">	
			AND
				memorandum_list_seq = #{memorandumSeq}
		</if>
	</select>
	
	<select id="getMemroandumAllList" parameterType="String" resultType="MemorandumList">
		SELECT
			seq, gbl_seq AS gblSeq, write_date AS writeDate
		FROM
			memorandum_list
		WHERE
			gbl_seq = #{value}
	</select>
	
	<select id="getMemorandumListSelectOne" parameterType="MemorandumList" resultType="memorandumList">
		SELECT
			seq, gbl_seq AS gblSeq, write_date AS writeDate
		FROM
			memorandum_list
		WHERE
			seq = #{seq}
	</select>
	
	<insert id="addMemorandumList" parameterType="MemorandumList">
		INSERT INTO
			memorandum_list
			(
				gbl_seq, write_date
			)
		VALUES
		(
			#{gblSeq}, SYSDATE()
		)
	    <selectKey keyProperty="seq" resultType="Integer">     
			SELECT LAST_INSERT_ID()        
	    </selectKey>
	</insert>
	
	<insert id="insertMemorandum" parameterType="Memorandum">
		INSERT INTO
			memorandum
			(
				type, subject, comment, area, articles, article_comment, chief_of_office, office_info, area_director, gbl_seq, write_date, memorandum_list_seq
			)
		VALUES
			(
				#{type}, #{subject}, #{comment}, #{area}, #{articles}, #{articleComment}, #{chiefOfOffice}, #{officeInfo}, #{areaDirector}, #{gblSeq}, SYSDATE(), #{memorandumSeq}
			)
	</insert>
	
	<insert id="insertInvoiceMemorandum" parameterType="Memorandum">
		INSERT INTO
			memorandum
			(
				type, memorandum_list_seq, gbl_seq, write_date
				<choose>
					<when test="type == '04'">
						, extra_pick_up_charge
					</when>
					<when test="type == '05'">
						, termination
					</when>
					<when test="type == '06'">
						, sit_start_date
					</when>
					<when test="type == '07'">
						, sit_end_date
					</when>
					<when test="type == '08'">
						, long_carry
					</when>					
				</choose>
			)
			VALUES
			(
				#{type},
				#{memorandumSeq},
				#{gblSeq},
				SYSDATE(),
				#{invoiceValue}
			)
	</insert>
	
	<update id="updateMemorandum" parameterType="Memorandum">
	    UPDATE
	    	memorandum
	    SET
	    	subject = #{subject},
	    	comment = #{comment},
	    	area = #{area},
	    	articles = #{articles},
	    	article_comment = #{articleComment},
	    	chief_of_office = #{chiefOfOffice},
	    	office_info = #{officeInfo},
	    	area_director = #{areaDirector}
	    WHERE
	    	gbl_seq = #{gblSeq}
	    AND
	    	type = #{type}	    
	</update>
	
	<delete id="deleteMemorandum" parameterType="Memorandum">
		DELETE FROM
			memorandum
		WHERE
			gbl_seq = #{gblSeq}
		AND
			type = #{type}
		AND
			memorandum_list_seq = #{memorandumSeq}
	</delete>
</mapper>